{
    "Name": "PV Spectral Correction",
    "Width": 874.0,
    "Height": 289.0,
    "FormObjects": {
        "GroupBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 4"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 12.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 12.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 846.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 255.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "PV Spectral Correction Modeling"
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 1.0
                }
            }
        },
        "Label": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "object 7"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 48.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 60.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 318.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 60.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Apply spectral correction factors based on:"
                },
                "TextColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "Bold": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "FontSize": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "WordWrap": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignRight": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "AlignTop": {
                    "Type": 2.0,
                    "Boolean": 0.0
                }
            }
        },
        "MultilineText": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "spectral_correction_celltech"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 498.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 96.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 292.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 30.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Text": {
                    "Type": 5.0,
                    "String": ""
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "RadioChoice": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "spectral_correction_model_choice"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 48.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 123.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 318.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 90.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Selection": {
                    "Type": 3.0,
                    "Integer": 0.0
                },
                "Items": {
                    "Type": 6.0,
                    "StringList": "Airmass only|Air mass and precipitable water|Airmass and clearsky index"
                },
                "ShowCaptions": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "Horizontal": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "MultilineText": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "spectral_correction_msg"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 498.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 135.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 292.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 75.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Text": {
                    "Type": 5.0,
                    "String": ""
                },
                "Editable": {
                    "Type": 2.0,
                    "Boolean": 0.0
                },
                "ForeColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 0.0,
                        "Green": 0.0,
                        "Blue": 0.0,
                        "Alpha": 255.0
                    }
                },
                "BackColour": {
                    "Type": 4.0,
                    "Color": {
                        "Red": 255.0,
                        "Green": 255.0,
                        "Blue": 255.0,
                        "Alpha": 255.0
                    }
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        },
        "CheckBox": {
            "Visible": 1.0,
            "ObjectProperties": {
                "Name": {
                    "Type": 5.0,
                    "String": "spectral_recommend_choice"
                },
                "X": {
                    "Type": 3.0,
                    "Integer": 498.0
                },
                "Y": {
                    "Type": 3.0,
                    "Integer": 54.0
                },
                "Width": {
                    "Type": 3.0,
                    "Integer": 306.0
                },
                "Height": {
                    "Type": 3.0,
                    "Integer": 24.0
                },
                "Tool Tip": {
                    "Type": 5.0,
                    "String": ""
                },
                "Caption": {
                    "Type": 5.0,
                    "String": "Use recommended model"
                },
                "State": {
                    "Type": 2.0,
                    "Boolean": 1.0
                },
                "TabOrder": {
                    "Type": 3.0,
                    "Integer": -1.0
                }
            }
        }
    },
    "VarDatabase": {
        "celltech": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "",
            "Units": "",
            "Group": "",
            "IndexLabels": "",
            "Flags": 8.0,
            "DefaultValue": 0.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "spectral_correction_model_choice": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "",
            "Units": "",
            "Group": "",
            "IndexLabels": "",
            "Flags": 2.0,
            "DefaultValue": 0.0,
            "UIObject": "Default",
            "sscVariableName": "",
            "sscVariableValue": ""
        },
        "spectral_recommend_choice": {
            "Version": 4.0,
            "Type": 1.0,
            "Label": "",
            "Units": "",
            "Group": "",
            "IndexLabels": "",
            "Flags": 0.0,
            "DefaultValue": 0.0,
            "UIObject": "CheckBox",
            "sscVariableName": "",
            "sscVariableValue": ""
        }
    },
    "Equations": [
        "equations{'spectral_correction_celltech'} = define() {\r",
        "\tmodel = ${module_model};\r",
        "\tif (model == 0) {\r",
        "\t\treturn 'Cell technology is not specified for the Simple Efficiency model, as spectral correction is not applied.';\r",
        "\t}\r",
        "\telse {\r",
        "\t\treturn ?${celltech} [\r",
        "\t\t\t'monoSi',\r",
        "\t\t\t'multiSi',\r",
        "\t\t\t'CdTe',\r",
        "\t\t\t'CIS',\r",
        "\t\t\t'CIGS',\r",
        "\t\t\t'Amorphous',\r",
        "\t\t];\r",
        "\t}\r",
        "};\r",
        "\r",
        "equations{'celltech'} = define() {\r",
        "\tmodel = ${module_model};\r",
        "\tif (model == 0) {\r",
        "\t\treturn 0; //default to mono? spe does not use scf\r",
        "\t}\r",
        "\telse if (model == 1) {\r",
        "\t\tm = lower(${cec_material});\r",
        "\t\tif( strpos(m,'mono')>=0 ) celltech = 0;\r",
        "\t\telseif ( strpos(m, 'multi') >= 0 ) celltech = 1;\r",
        "\t\telseif( strpos(m, 'thin')>=0 ) celltech=2;\r",
        "\t\telseif( strpos(m, 'cis')>=0) celltech=3;\r",
        "\t\telseif( strpos(m, 'cigs')>=0) celltech=4;\r",
        "\t\telseif( strpos(m, 'a-si')>=0) celltech=5;\r",
        "\t\treturn celltech;\r",
        "\t}\r",
        "\telse if (model == 2) {\r",
        "\t\treturn ${6par_celltech};\r",
        "\t}\r",
        "\telse if (model == 3) {\r",
        "\t\tm = lower(${snl_material});\r",
        "\t\tif( strpos(m,'c-si')>=0 ) celltech = 0;\r",
        "\t\telseif ( strpos(m, 'mc') >= 0 ) celltech = 1;\r",
        "\t\telseif( strpos(m, 'cdte')>=0 ) celltech=2;\r",
        "\t\telseif( strpos(m, 'cis')>=0) celltech=3;\r",
        "\t\telseif( strpos(m, 'cigs')>=0) celltech=4;\r",
        "\t\telseif( strpos(m, 'a-si')>=0) celltech=5;\r",
        "\t\treturn celltech;\r",
        "\t}\r",
        "\telse if (model == 4) {\r",
        "\t\treturn ${sd11par_type};\r",
        "\t}\r",
        "\telse return 0;\r",
        "};\r",
        "\t\t\t"
    ],
    "Callbacks": [
        "on_load{'PV Spectral Correction'} = define() \r",
        "{\r",
        "\trecommend_model();\r",
        "};\r",
        "\r",
        "function recommend_model() {\r",
        "\tchoice = value('spectral_recommend_choice');\r",
        "\tmsg = '';\r",
        "\tif (choice == 0) { //Not checked\r",
        "\t\tenable('spectral_correction_model_choice', true); //keep it enabled\r",
        "\t\t\r",
        "\t}\r",
        "\telse {\r",
        "\t\tenable('spectral_correction_model_choice', false);\r",
        "\t\tif (value('celltech') < 2) {\r",
        "\t\t\tmsg += 'Any model will work for monocrystalline or multicrystalline Silicon cell types.\\n';\r",
        "\t\t}\r",
        "\t\telse {\r",
        "\t\t\tmsg += 'Precipitable water or clearsky index is needed to more accurately calculate spectral correction factors for this cell type. Precipitable water must be available in the weather file for the simulation to complete.\\n';\r",
        "\t\t}\r",
        "\t\tif (isnan(value('annual_precipitation'))) {\r",
        "\t\t\tmsg += 'Annual precipitable water was not calculated from the weather file. Ensure that precipitable water is included in the weather before using the Airmass and precipitable water option.\\n';\r",
        "\t\t\tif(isnan(value('annual_clearsky_ghi'))) {\r",
        "\t\t\t\tmsg += 'Could not find clearsky ghi from weather data.\\n';\r",
        "\t\t\t\tvalue('spectral_correction_model_choice', 0);\r",
        "\t\t\t}\r",
        "\t\t\telse {\r",
        "\t\t\t\tvalue('spectral_correction_model_choice', 2);\r",
        "\t\t\t}\r",
        "\t\t\t\t\r",
        "\t\t}\r",
        "\t\telse {\r",
        "\t\t\tvalue('spectral_correction_model_choice', 1);\r",
        "\t\t}\r",
        "\t\t\r",
        "\t\t\r",
        "\t}\r",
        "\trefresh();\r",
        "}"
    ]
}